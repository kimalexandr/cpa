<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Восстановление пароля — RealCPA Hub</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-link"></i>
                    <a href="index.html" class="logo-link">RealCPA Hub</a>
                </div>
                <nav class="nav">
                    <a href="index.html" class="nav-link">Главная</a>
                    <a href="offers.html" class="nav-link">Офферы</a>
                    <a href="support.html" class="nav-link">Поддержка</a>
                    <span class="nav-auth nav-auth-guest">
                        <a href="login.html" class="nav-link btn-nav-login">Войти</a>
                        <a href="register.html" class="nav-link btn-nav-register">Регистрация</a>
                    </span>
                </nav>
                <button class="mobile-menu-toggle" id="mobileMenuToggle"><i class="fas fa-bars"></i></button>
            </div>
        </div>
    </header>

    <section class="auth-section">
        <div class="container">
            <div class="auth-container">
                <div class="auth-form active" style="max-width: 420px;">
                    <h2>Восстановление пароля</h2>
                    <p class="auth-description">Введите email, указанный при регистрации. Мы отправим ссылку для сброса пароля.</p>
                    <form id="forgotForm">
                        <div class="form-group">
                            <label for="forgotEmail">Email</label>
                            <input type="email" id="forgotEmail" required placeholder="example@mail.ru">
                        </div>
                        <button type="submit" class="btn btn-primary btn-block" id="forgotSubmitBtn">
                            Отправить ссылку
                        </button>
                    </form>
                    <div id="forgotMessage" class="auth-message" style="display: none; margin-top: 1rem;"></div>
                    <div id="forgotResetLink" class="auth-reset-link" style="display: none; margin-top: 1rem; font-size: 0.9rem; word-break: break-all;"></div>
                    <p style="margin-top: 1.5rem;">
                        <a href="login.html" class="auth-forgot-link">Вернуться к входу</a>
                    </p>
                </div>
            </div>
        </div>
    </section>

    <div id="footer-placeholder"></div>
    <script src="footer-include.js"></script>
    <script src="api.js"></script>
    <script src="script.js"></script>
    <script>
    (function() {
        var form = document.getElementById('forgotForm');
        var messageEl = document.getElementById('forgotMessage');
        var resetLinkEl = document.getElementById('forgotResetLink');
        var submitBtn = document.getElementById('forgotSubmitBtn');
        if (!form || typeof window.RealCPA === 'undefined') return;

        form.addEventListener('submit', function(e) {
            e.preventDefault();
            var email = (document.getElementById('forgotEmail') || {}).value.trim();
            if (!email) {
                if (messageEl) { messageEl.style.display = 'block'; messageEl.className = 'auth-message error'; messageEl.textContent = 'Введите email.'; }
                return;
            }
            if (resetLinkEl) resetLinkEl.style.display = 'none';
            if (messageEl) { messageEl.style.display = 'block'; messageEl.className = 'auth-message'; messageEl.textContent = 'Отправка…'; }
            if (submitBtn) submitBtn.disabled = true;

            window.RealCPA.auth.forgotPassword(email)
                .then(function(r) {
                    if (messageEl) {
                        messageEl.className = 'auth-message success';
                        messageEl.textContent = r.message || 'Если аккаунт с таким email существует, на него отправлена ссылка. Проверьте почту.';
                    }
                    if (r.resetLink && resetLinkEl) {
                        resetLinkEl.style.display = 'block';
                        resetLinkEl.innerHTML = 'Ссылка для разработки: <a href="' + r.resetLink + '">перейти к сбросу пароля</a>';
                    }
                })
                .catch(function(err) {
                    if (messageEl) {
                        messageEl.className = 'auth-message error';
                        messageEl.textContent = err.message || err.payload?.error || 'Ошибка запроса. Попробуйте позже.';
                    }
                })
                .finally(function() {
                    if (submitBtn) submitBtn.disabled = false;
                });
        });
    })();
    </script>
</body>
</html>
