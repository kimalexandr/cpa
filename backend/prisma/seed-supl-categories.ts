/**
 * Сид категорий в формате Supl.biz: 1-й уровень (группы) и 2-й уровень (подкатегории).
 * Запуск: npx ts-node -P tsconfig.seed.json prisma/seed-supl-categories.ts
 */
import 'dotenv/config';
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

const RU = 'абвгдежзийклмнопрстуфхцчшщъыьэюяё';
const EN = 'abvgdezhziyklmnoprstufkhtschshch y eiuayo';
function slug(s: string): string {
  let t = s.toLowerCase().trim();
  let out = '';
  for (let i = 0; i < t.length; i++) {
    const c = t[i];
    const idx = RU.indexOf(c);
    if (idx >= 0) out += EN[idx];
    else if (/[a-z0-9]/.test(c)) out += c;
    else if (c === ' ' || c === '-') out += (out.slice(-1) === '-' ? '' : '-');
  }
  return out.replace(/-+/g, '-').replace(/^-|-$/g, '') || 'cat';
}

const LEVEL1: { name: string; children: string[] }[] = [
  { name: 'Оборудование и инструменты', children: ['Сварочное оборудование', 'Бензоинструмент', 'Слесарно-монтажный инструмент', 'Оборудование для автосервиса', 'Электроинструмент'] },
  { name: 'Металлы', children: ['Трубопроводная и запорная арматура', 'Листовой прокат', 'Цветной металлопрокат', 'Нержавеющий металлопрокат', 'Сортовой прокат'] },
  { name: 'Автотовары', children: ['Автоаксессуары', 'Корейские автомобили и запчасти', 'Автошины и диски', 'Европейские автомобили и запчасти', 'Японские автомобили и запчасти'] },
  { name: 'Одежда, обувь, игрушки', children: ['Игрушки', 'Аксессуары', 'Одежда и обувь для взрослых', 'Детская одежда и обувь', 'Бижутерия, украшения'] },
  { name: 'Электроника и электротехника', children: ['Светотехника', 'Кабель и провод', 'Электротехническая продукция', 'Электроустановочные изделия', 'Контрольно-измерительные приборы (КИПиА)'] },
  { name: 'Хозтовары, упаковка, канцелярия', children: ['Канцелярские товары', 'Посуда', 'Садово-огородный инвентарь и техника', 'Подарочная упаковка', 'Одноразовая посуда'] },
  { name: 'Потребительские товары и спецмагазины', children: ['Товары для творчества, развивающие игры', 'Сувениры и подарки', 'Товары для новорожденных', 'Надувная мебель, бассейны', 'Товары для праздника'] },
  { name: 'Строительные материалы', children: ['Крепежные изделия', 'Железобетонные изделия', 'Сантехника', 'Сухие строительные смеси', 'Лакокрасочные материалы'] },
  { name: 'Текстиль для дома', children: ['Постельные принадлежности', 'Предметы интерьера', 'Портьерные ткани, шторы', 'Швейная фурнитура', 'Пряжа'] },
  { name: 'Компьютеры, бытовая и офисная техника', children: ['Музыкальные инструменты, аксессуары', 'Бытовая техника', 'Компьютеры и комплектующие', 'Аудио и видеотехника', 'Оргтехника, обслуживание, заправка картриджей'] },
  { name: 'Мебель и фурнитура', children: ['Мебель корпусная', 'Мебель офисная', 'Мебель для ванных комнат', 'Мебель для кухни', 'Мебель детская'] },
  { name: 'Здоровье и красота', children: ['Косметика и расходные материалы для салонов красоты', 'Косметика и парфюмерия', 'Биологически активные добавки (БАД)', 'Медицинские расходные материалы', 'Медицинское оборудование, инструмент'] },
  { name: 'Спорт. Туризм. Отдых', children: ['Снаряжение для туризма и отдыха', 'Рыболовные принадлежности, принадлежности для охоты', 'Велосипеды', 'Спортивное оборудование', 'Спортивная одежда и обувь'] },
  { name: 'Строительство', children: ['Системы отопления, водоснабжения, канализации', 'Ремонтные и отделочные работы', 'Дымоходные системы', 'Строительство зданий, сооружений', 'Проектирование и автоматизация инженерных систем'] },
  { name: 'Полиграфия и реклама', children: ['Бизнес‑сувениры, печать на кружках, футболках, сувенирной продукции', 'Товары для нанесения изображений', 'Цифровая печать', 'Офсетная печать', 'Расходные материалы для полиграфии'] },
  { name: 'Продукты питания, напитки', children: ['Овощи и фрукты', 'Хлебобулочные и кондитерские изделия', 'Молочные продукты', 'Полуфабрикаты', 'Сырье для пищевой промышленности'] },
  { name: 'Химия и топливо', children: ['Промышленная химия, химическое сырье', 'Дезинфицирующие средства', 'Нефтепродукты, ГСМ, газ', 'Противогололедные реагенты', 'Технические газы, криогенные жидкости'] },
  { name: 'Охрана и безопасность', children: ['Системы безопасности и охраны', 'Продажа, ремонт, установка домофонов', 'Противопожарное оборудование', 'Пломбировочные устройства', 'Противокражное оборудование'] },
  { name: 'Ит. Интернет. Связь.', children: ['Мобильные телефоны и аксессуары к ним', 'Коммутационное оборудование', 'Программное обеспечение', 'Антенное оборудование', 'Разработка, поддержка, продвижение web‑сайтов'] },
  { name: 'Товары и услуги для животных', children: ['Зоотовары', 'Ветеринарные препараты', 'Корм для животных', 'Комбикорм и кормовые добавки', 'Сельскохозяйственные корма'] },
  { name: 'Коммунальные услуги', children: ['Изготовление ключей', 'Ремонт и монтаж систем отопления, водоснабжения, канализации', 'Благоустройство улиц и территории', 'Реконструкция и капремонт зданий', 'Дезинфекция, дератизация, дезинсекция'] },
  { name: 'Транспортные услуги', children: ['Грузоперевозки', 'Специализированные дорожные средства и устройства', 'Заказ строительной и спецтехники', 'Заказ автобусов', 'Материалы для железнодорожных путей'] },
  { name: 'Юридические, финансовые и бизнес‑услуги', children: ['Изготовление печатей и штампов', 'Юридические услуги', 'Маркетинговые услуги', 'Сертификация и лицензирование', 'Оценка, экспертиза'] },
];

async function main() {
  for (const group of LEVEL1) {
    const parentSlug = slug(group.name);
    const parent = await prisma.category.upsert({
      where: { slug: parentSlug },
      update: { name: group.name, level: 1, isActive: true },
      create: { name: group.name, slug: parentSlug, level: 1, isActive: true },
    });
    for (const childName of group.children) {
      const childSlug = slug(childName);
      await prisma.category.upsert({
        where: { slug: childSlug },
        update: { name: childName, parentId: parent.id, level: 2, isActive: true },
        create: { name: childName, slug: childSlug, parentId: parent.id, level: 2, isActive: true },
      });
    }
  }
  console.log('Supl.biz categories seeded: %d level-1, %d level-2', LEVEL1.length, LEVEL1.reduce((s, g) => s + g.children.length, 0));
}

main()
  .catch((e) => { console.error(e); process.exit(1); })
  .finally(() => prisma.$disconnect());
