<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Настройки — Админ — RealCPA Hub</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="admin.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="admin-page">
    <header class="admin-header">
        <div class="admin-header-inner">
            <a href="../index.html" class="admin-logo"><i class="fas fa-link"></i> RealCPA Hub</a>
            <span class="admin-title">Админ-панель</span>
            <div class="admin-header-user">
                <span class="admin-user-name" id="adminUserName"></span>
                <a href="../index.html" class="admin-logout" id="adminLogout">Выход</a>
            </div>
        </div>
    </header>
    <div class="admin-layout">
        <aside class="admin-sidebar">
            <nav class="admin-nav">
                <a href="index.html" class="admin-nav-link"><i class="fas fa-tachometer-alt"></i> Главная</a>
                <a href="users.html" class="admin-nav-link"><i class="fas fa-users"></i> Пользователи</a>
                <a href="offers.html" class="admin-nav-link"><i class="fas fa-briefcase"></i> Офферы</a>
                <a href="categories.html" class="admin-nav-link"><i class="fas fa-folder"></i> Категории</a>
                <a href="geography.html" class="admin-nav-link"><i class="fas fa-globe"></i> География</a>
                <a href="moderation.html" class="admin-nav-link"><i class="fas fa-clipboard-check"></i> Модерация</a>
                <a href="finance.html" class="admin-nav-link"><i class="fas fa-wallet"></i> Финансы</a>
                <a href="settings.html" class="admin-nav-link active"><i class="fas fa-cog"></i> Настройки</a>
                <a href="logs.html" class="admin-nav-link"><i class="fas fa-history"></i> Логи</a>
            </nav>
        </aside>
        <main class="admin-main">
            <div class="admin-toolbar"><h1 class="admin-page-title">Настройки платформы</h1></div>
            <div class="admin-card" style="max-width: 600px;">
                <h2 class="admin-card-label" style="font-size:1rem; margin-bottom:0.75rem">Общие</h2>
                <div class="form-group">
                    <label for="settingsPlatformName">Название платформы</label>
                    <input type="text" id="settingsPlatformName" class="form-input" value="RealCPA Hub" placeholder="RealCPA Hub">
                </div>
                <div class="form-group">
                    <label for="settingsSupportEmail">Email поддержки</label>
                    <input type="email" id="settingsSupportEmail" class="form-input" placeholder="support@example.com">
                </div>
                <div class="form-group">
                    <label for="settingsSupportPhone">Телефон поддержки</label>
                    <input type="text" id="settingsSupportPhone" class="form-input" placeholder="+7 (999) 123-45-67">
                </div>
                <h2 class="admin-card-label" style="font-size:1rem; margin:1.25rem 0 0.75rem">Комиссия платформы</h2>
                <div class="form-group">
                    <label for="settingsCommissionPercent">Комиссия с выплат партнёрам, %</label>
                    <input type="number" id="settingsCommissionPercent" class="form-input" min="0" max="100" step="0.5" value="0" placeholder="0">
                </div>
                <h2 class="admin-card-label" style="font-size:1rem; margin:1.25rem 0 0.75rem">Интеграции</h2>
                <p class="admin-card-label" style="margin-bottom:0.5rem">Подключение платёжных систем, CRM и трекера — в следующих версиях.</p>
                <button type="button" class="btn btn-primary" id="settingsSaveBtn">Сохранить</button>
                <p class="admin-card-label" style="margin-top:1rem; color: var(--text-light); font-size:0.875rem" id="settingsSaveHint">Настройки сохраняются локально. Для сохранения на сервере подключите API настроек.</p>
            </div>
        </main>
    </div>
    <script src="../api.js"></script>
    <script>
    (function() {
        if (!window.RealCPA || !window.RealCPA.isLoggedIn() || window.RealCPA.getRole() !== 'admin') {
            window.location.href = '../login.html?redirect=' + encodeURIComponent('admin/settings.html');
            return;
        }
        var u = window.RealCPA.getUser();
        document.getElementById('adminUserName').textContent = (u && (u.name || u.email)) || 'Админ';

        var STORAGE_KEY = 'realcpa_admin_settings';
        function loadLocal() {
            try {
                var s = localStorage.getItem(STORAGE_KEY);
                if (s) {
                    var data = JSON.parse(s);
                    if (data.platformName) document.getElementById('settingsPlatformName').value = data.platformName;
                    if (data.supportEmail) document.getElementById('settingsSupportEmail').value = data.supportEmail;
                    if (data.supportPhone) document.getElementById('settingsSupportPhone').value = data.supportPhone;
                    if (data.commissionPercent != null) document.getElementById('settingsCommissionPercent').value = data.commissionPercent;
                }
            } catch (e) {}
        }
        function saveLocal() {
            var data = {
                platformName: document.getElementById('settingsPlatformName').value.trim(),
                supportEmail: document.getElementById('settingsSupportEmail').value.trim(),
                supportPhone: document.getElementById('settingsSupportPhone').value.trim(),
                commissionPercent: document.getElementById('settingsCommissionPercent').value
            };
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
                var hint = document.getElementById('settingsSaveHint');
                hint.textContent = 'Сохранено локально.';
                setTimeout(function() { hint.textContent = 'Настройки сохраняются локально. Для сохранения на сервере подключите API настроек.'; }, 2000);
            } catch (e) {
                alert('Ошибка сохранения');
            }
        }
        loadLocal();
        document.getElementById('settingsSaveBtn').addEventListener('click', saveLocal);
        document.getElementById('adminLogout').onclick = function(e) { e.preventDefault(); window.RealCPA.clearAuth(); window.location.href = '../index.html'; };
    })();
    </script>
</body>
</html>
